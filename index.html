<!DOCTYPE html>
<html>
<head>
    <title>ALF - I accept cats as payment</title>
    <script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
</head>
<body>
    <a href="https://github.com/gisinc/arcgis-level-fixer"><img style="position: absolute; top: 0; left: 0; border: 0;" src="https://camo.githubusercontent.com/567c3a48d796e2fc06ea80409cc9dd82bf714434/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_darkblue_121621.png"></a>
    <div style="text-align: center">
        <h1><strong style="color:darkred">A</strong>rcGIS <strong style="color:darkred">L</strong>evel <strong style="color:darkred">F</strong>ixer</h1>
        <img src="http://img2.wikia.nocookie.net/__cb20110128060130/alf/images/9/92/Cat_sandwich.jpg"/>
        <br>
        <b>Where is the MapServer?</b><br>
        <input style="width:80%; text-align: center" type="text" id="inputtext" placeholder="http://gismaps.vita.virginia.gov/arcgis/rest/services/MostRecentImagery/MostRecentImagery_WGS/MapServer">
        <br>
        <input type="button" value="submit "id="submit"><img id="spinner" style="display:none" src="/ajax-loader.gif"/>
        <br><br><br>
        <div id="response">
        </div>
    </div>

    <script>
        function startLoading() {
            $("#submit").hide();
            $("#spinner").show();
        }
        function stopLoading() {
            $("#submit").show();
            $("#spinner").hide();
        }
        $("#inputtext").keyup(function(e){
            if(e.keyCode == 13)
            {
                $("#submit").click();
            }
        });
        $("#submit").click(function()
        {
            startLoading();
            var dataString = $("#inputtext").val();

            $.ajax({
                type: "GET",
                url: "/examine?url=" + dataString,
                success: function(result){
                    $("#response").html(result);
                    var html = "";

                    if(result.lods["0"] === 0) {
                        html += "<h1>It's already a good URL!</h1><br><i>it should work as a basemap</i>";
                    } else {
                        html += "<b>Use this url for your basemap:</b><br><a href=''" + result.alf + "'>" + result.alf + "</a>";
                    }

                    html += "<br><br><b>Zoom Levels:</b><br>";

                    html += "<table style='margin: 0 auto; border: 1;'><tr><th>OSM LOD</th><th>Original LOD</th></tr>";

                    for(var lodOSM in result.lods) {
                        html += "<tr><td>"+lodOSM+"</td><td>"+result.lods[lodOSM]+"</td></tr>";
                    }

                    html += "</table>";

                    $("#response").html(html);
                    stopLoading();
                },
                error: function(result) {
                    $("#response").html("<b>this doesn't taste like a cat</b><br><br>it should look like this:<br><a href='http://gismaps.vita.virginia.gov/arcgis/rest/services/MostRecentImagery/MostRecentImagery_WGS/MapServer'>http://gismaps.vita.virginia.gov/arcgis/rest/services/MostRecentImagery/MostRecentImagery_WGS/MapServer</a>");
                    stopLoading();
                }
            });
        });
    </script>
</body>
</html>